Shader "THH/GaussBlur"
{
    Properties
    {
        _MainTex ("Texture", 2D) = "white" {}
        //_BlurRadius ("Blur Radius", Range(0, 20)) = 1
        //_Sigma ("Sigma", Range(0.5, 20)) = 1

        _StencilComp ("Stencil Comparison", Float) = 8
        _Stencil ("Stencil ID", Float) = 0
        _StencilOp ("Stencil Operation", Float) = 0
        _StencilWriteMask ("Stencil Write Mask", Float) = 255
        _StencilReadMask ("Stencil Read Mask", Float) = 255
        _ColorMask ("Color Mask", Float) = 15
    }
    SubShader
    {
        Tags
        { 
            "RenderType"="Transparent" 
            "IgnoreProjector"="True"
            "Queue" = "Transparent"
            "PreviewType"="Plane"
            "CanUseSpriteAtlas"="True"
        }
        LOD 100
        Stencil
        {
            Ref [_Stencil]
            Comp [_StencilComp]
            Pass [_StencilOp] 
            ReadMask [_StencilReadMask]
            WriteMask [_StencilWriteMask]
        }
        ColorMask [_ColorMask]

        Blend SrcAlpha OneMinusSrcAlpha
        Cull Off
        ZWrite Off
        ZTest Always 
        ZClip True

        Pass
        {
            CGPROGRAM
            #pragma vertex vert
            #pragma fragment frag

            #include "UnityCG.cginc"

            struct appdata
            {
                float4 vertex : POSITION;
                half2 uv      : TEXCOORD0;
            };

            struct v2f
            {
                half2 uv      : TEXCOORD0;
                float4 vertex : SV_POSITION;
            };

            sampler2D _MainTex;
            CBUFFER_START(UnityPerMaterial)
                float4 _MainTex_ST;
                float4 _MainTex_TexelSize;
                float _BlurRadius;
                float _Sigma;
            CBUFFER_END

            
            half4 GaussBlur(float2 uv)
            {
                float weight[20 * 20] = {0.012718,0.012577,0.012164,0.011505,0.010642,0.009627,0.008517,0.007369,0.006235,0.005160,0.004175,0.003305,0.002558,0.001936,0.001433,0.001038,0.000735,0.000509,0.000344,0.000228,
                                         0.012577,0.012438,0.012029,0.011378,0.010524,0.009521,0.008423,0.007287,0.006166,0.005102,0.004129,0.003268,0.002529,0.001915,0.001417,0.001026,0.000727,0.000503,0.000341,0.000226,
                                         0.012164,0.012029,0.011634,0.011004,0.010179,0.009208,0.008146,0.007048,0.005963,0.004935,0.003993,0.003161,0.002446,0.001852,0.001371,0.000992,0.000703,0.000487,0.000329,0.000218,
                                         0.011505,0.011378,0.011004,0.010408,0.009627,0.008709,0.007705,0.006666,0.005640,0.004667,0.003777,0.002989,0.002314,0.001751,0.001297,0.000939,0.000665,0.000460,0.000312,0.000206,
                                         0.010642,0.010524,0.010179,0.009627,0.008905,0.008056,0.007127,0.006166,0.005217,0.004317,0.003494,0.002765,0.002140,0.001620,0.001199,0.000868,0.000615,0.000426,0.000288,0.000191,
                                         0.009627,0.009521,0.009208,0.008709,0.008056,0.007287,0.006447,0.005578,0.004720,0.003905,0.003161,0.002501,0.001936,0.001466,0.001085,0.000785,0.000556,0.000385,0.000261,0.000173,
                                         0.008517,0.008423,0.008146,0.007705,0.007127,0.006447,0.005704,0.004935,0.004175,0.003455,0.002796,0.002213,0.001713,0.001297,0.000960,0.000695,0.000492,0.000341,0.000231,0.000153,
                                         0.007369,0.007287,0.007048,0.006666,0.006166,0.005578,0.004935,0.004269,0.003613,0.002989,0.002419,0.001915,0.001482,0.001122,0.000830,0.000601,0.000426,0.000295,0.000200,0.000132,
                                         0.006235,0.006166,0.005963,0.005640,0.005217,0.004720,0.004175,0.003613,0.003057,0.002529,0.002047,0.001620,0.001254,0.000949,0.000703,0.000509,0.000360,0.000249,0.000169,0.000112,
                                         0.005160,0.005102,0.004935,0.004667,0.004317,0.003905,0.003455,0.002989,0.002529,0.002093,0.001694,0.001341,0.001038,0.000785,0.000581,0.000421,0.000298,0.000206,0.000140,0.000093,
                                         0.004175,0.004129,0.003993,0.003777,0.003494,0.003161,0.002796,0.002419,0.002047,0.001694,0.001371,0.001085,0.000840,0.000636,0.000471,0.000341,0.000241,0.000167,0.000113,0.000075,
                                         0.003305,0.003268,0.003161,0.002989,0.002765,0.002501,0.002213,0.001915,0.001620,0.001341,0.001085,0.000859,0.000665,0.000503,0.000372,0.000270,0.000191,0.000132,0.000090,0.000059,
                                         0.002558,0.002529,0.002446,0.002314,0.002140,0.001936,0.001713,0.001482,0.001254,0.001038,0.000840,0.000665,0.000514,0.000389,0.000288,0.000209,0.000148,0.000102,0.000069,0.000046,
                                         0.001936,0.001915,0.001852,0.001751,0.001620,0.001466,0.001297,0.001122,0.000949,0.000785,0.000636,0.000503,0.000389,0.000295,0.000218,0.000158,0.000112,0.000077,0.000052,0.000035,
                                         0.001433,0.001417,0.001371,0.001297,0.001199,0.001085,0.000960,0.000830,0.000703,0.000581,0.000471,0.000372,0.000288,0.000218,0.000162,0.000117,0.000083,0.000057,0.000039,0.000026,
                                         0.001038,0.001026,0.000992,0.000939,0.000868,0.000785,0.000695,0.000601,0.000509,0.000421,0.000341,0.000270,0.000209,0.000158,0.000117,0.000085,0.000060,0.000042,0.000028,0.000019,
                                         0.000735,0.000727,0.000703,0.000665,0.000615,0.000556,0.000492,0.000426,0.000360,0.000298,0.000241,0.000191,0.000148,0.000112,0.000083,0.000060,0.000042,0.000029,0.000020,0.000013,
                                         0.000509,0.000503,0.000487,0.000460,0.000426,0.000385,0.000341,0.000295,0.000249,0.000206,0.000167,0.000132,0.000102,0.000077,0.000057,0.000042,0.000029,0.000020,0.000014,0.000009,
                                         0.000344,0.000341,0.000329,0.000312,0.000288,0.000261,0.000231,0.000200,0.000169,0.000140,0.000113,0.000090,0.000069,0.000052,0.000039,0.000028,0.000020,0.000014,0.000009,0.000006,
                                         0.000228,0.000226,0.000218,0.000206,0.000191,0.000173,0.000153,0.000132,0.000112,0.000093,0.000075,0.000059,0.000046,0.000035,0.000026,0.000019,0.000013,0.000009,0.000006,0.000004};
                
                float4 col = float4(0, 0, 0, 0);
                
                for (int x = 0; x < 20; ++x)
                {
                    for(int y = 0; y < 20; ++y)
                    {
                        col += tex2D(_MainTex, uv + float2(x * _MainTex_TexelSize.x, y * _MainTex_TexelSize.y)) * weight[x * 20 + y];
                        col += tex2D(_MainTex, uv + float2(-x * _MainTex_TexelSize.x, y * _MainTex_TexelSize.y)) * weight[x * 20 + y]; 
                        col += tex2D(_MainTex, uv + float2(x * _MainTex_TexelSize.x, -y * _MainTex_TexelSize.y)) * weight[x * 20 + y]; 
                        col += tex2D(_MainTex, uv + float2(-x * _MainTex_TexelSize.x, -y * _MainTex_TexelSize.y)) * weight[x * 20 + y]; 
                    }
                }
                //col -= tex2D(_MainTex,uv) * weight[0];
                return col / 4;
            }


            v2f vert (appdata v)
            {
                v2f o;
                o.vertex = UnityObjectToClipPos(v.vertex);
                o.uv = v.uv;
                return o;
            }

            half4 frag (v2f i) : SV_Target
            {
                
                half2 uv = i.uv;
                half4 col = GaussBlur(uv);
                return col;
            }
            ENDCG
        }
    }
}
